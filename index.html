<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Mapa Conceptual - Modelos de Negocio</title>
  <script src="https://unpkg.com/gojs@2.3.15/release/go.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: #f1f5f9;
    }
    header {
      background-color: #004aad;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    nav {
      display: flex;
      justify-content: center;
      background-color: #e0e0e0;
      padding: 1rem;
      gap: 1rem;
    }
    nav button {
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    nav button:hover {
      background-color: #ccc;
    }
    #diagramDiv {
      width: 100%;
      height: 80vh;
      border-top: 1px solid #ccc;
    }
    .controls {
      text-align: center;
      padding: 1rem;
      background: #fff;
    }
    .controls button {
      margin: 0.5rem;
      padding: 0.5rem 1rem;
      background: #004aad;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .controls button:hover {
      background-color: #003580;
    }
  </style>
</head>
<body>
  <header>
    <h1>Mapa Conceptual Interactivo - Modelos de Negocio</h1>
  </header>

  <nav>
    <button onclick="loadModel('disruptivo')">Modelo Disruptivo</button>
    <button onclick="loadModel('cola')">Modelo de Cola Larga</button>
    <button onclick="loadModel('plataforma')">Modelo Plataforma Multilateral</button>
  </nav>

  <div class="controls">
    <button onclick="saveAsImage()">Exportar como Imagen</button>
    <button onclick="window.print()">Exportar como PDF</button>
  </div>

  <div id="diagramDiv"></div>

  <script>
    const $ = go.GraphObject.make;
    const diagram = $(go.Diagram, "diagramDiv", {
      "undoManager.isEnabled": true,
      layout: $(go.ForceDirectedLayout)
    });

    diagram.nodeTemplate =
      $(go.Node, "Auto",
        {
          resizable: true, resizeObjectName: "SHAPE",
          toolTip:
            $("ToolTip",
              $(go.TextBlock, { margin: 4 },
                new go.Binding("text", "desc"))
            ),
          doubleClick: function (e, node) {
            const nota = prompt("Escribe o edita tu nota:", node.data.desc || "");
            if (nota !== null) {
              diagram.model.startTransaction("update");
              diagram.model.setDataProperty(node.data, "desc", nota);
              diagram.model.commitTransaction("update");
              localStorage.setItem(node.data.key, nota);
            }
          }
        },
        $(go.Shape, "RoundedRectangle",
          {
            name: "SHAPE", fill: "#cce5ff", strokeWidth: 0
          }),
        $(go.TextBlock,
          { margin: 8, editable: false, font: "bold 14px sans-serif" },
          new go.Binding("text", "text"))
      );

    diagram.linkTemplate =
      $(go.Link,
        { routing: go.Link.AvoidsNodes, corner: 5 },
        $(go.Shape),
        $(go.Shape, { toArrow: "Standard" })
      );

    const modelos = {
      disruptivo: {
        class: "go.GraphLinksModel",
        nodeDataArray: [
          { key: "Disruptivo", text: "Modelo Disruptivo", desc: "Innovación que rompe el modelo tradicional" },
          { key: "IA", text: "Inteligencia Artificial", desc: "Aprendizaje automático, automatización avanzada" },
          { key: "Blockchain", text: "Blockchain", desc: "Transacciones seguras y descentralizadas" },
          { key: "IoT", text: "Internet de las Cosas", desc: "Conectividad entre dispositivos" },
          { key: "Cultura", text: "Cambio Cultural", desc: "Transformación organizacional" },
          { key: "Demanda", text: "Nuevas Demandas", desc: "Nuevas formas de consumir y producir" }
        ],
        linkDataArray: [
          { from: "Disruptivo", to: "IA" },
          { from: "Disruptivo", to: "Blockchain" },
          { from: "Disruptivo", to: "IoT" },
          { from: "Disruptivo", to: "Cultura" },
          { from: "Disruptivo", to: "Demanda" }
        ]
      },
      cola: {
        class: "go.GraphLinksModel",
        nodeDataArray: [
          { key: "Cola", text: "Modelo de Cola Larga", desc: "Vender más variedad en pequeñas cantidades" },
          { key: "Internet", text: "Internet", desc: "Acceso global y sin límites físicos" },
          { key: "Costos", text: "Reducción de Costos", desc: "Distribución digital eficiente" },
          { key: "Democratización", text: "Democratización", desc: "Acceso a herramientas de autor" },
          { key: "Amazon", text: "Amazon", desc: "Ejemplo clásico con libros de baja demanda" },
          { key: "LEGO", text: "LEGO", desc: "Kits personalizados por usuarios" }
        ],
        linkDataArray: [
          { from: "Cola", to: "Internet" },
          { from: "Cola", to: "Costos" },
          { from: "Cola", to: "Democratización" },
          { from: "Cola", to: "Amazon" },
          { from: "Cola", to: "LEGO" }
        ]
      },
      plataforma: {
        class: "go.GraphLinksModel",
        nodeDataArray: [
          { key: "Plataforma", text: "Modelo Multilateral", desc: "Interacción entre múltiples actores" },
          { key: "Red", text: "Efecto Red", desc: "Más usuarios = más valor" },
          { key: "Usuarios", text: "Usuarios", desc: "Clientes interdependientes" },
          { key: "Marketplace", text: "Marketplace", desc: "Amazon, eBay, Airbnb, Uber" },
          { key: "Redes", text: "Redes Sociales", desc: "Facebook, Instagram" }
        ],
        linkDataArray: [
          { from: "Plataforma", to: "Red" },
          { from: "Plataforma", to: "Usuarios" },
          { from: "Plataforma", to: "Marketplace" },
          { from: "Plataforma", to: "Redes" }
        ]
      }
    };

    function loadModel(name) {
      diagram.model = go.Model.fromJson(modelos[name]);
      diagram.nodes.each(node => {
        const saved = localStorage.getItem(node.data.key);
        if (saved) node.data.desc = saved;
      });
    }

    function saveAsImage() {
      const img = diagram.makeImageData({ background: "white", scale: 1 });
      const link = document.createElement("a");
      link.download = "mapa_modelo.png";
      link.href = img;
      link.click();
    }

    // Cargar modelo inicial
    loadModel("disruptivo");
  </script>
</body>
</html>

